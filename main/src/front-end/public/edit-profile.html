<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=, initial-scale=1.0" />
    <title>Edit Profile | Fonka</title>
  </head>
  <body>
    <nav>
      <a href="/home.html">home</a>

      <a href="/chats.html">chats</a>
      <a href="/edit-profile.html">edit profile</a>
      <a href="/matching.html">matching</a>
      <a href="/logout.html">logout</a>
    </nav>

    <header>
      <h1>Edit ur profile</h1>
    </header>

    <img src="" alt="profile picture" id="profile-picture" />
    <form id="edit-form">
      <fieldset>
        <legend>Account Related</legend>
        <div>
          <label
            >Email <input type="email" name="email" required disabled
          /></label>
        </div>
        <div>
          <label
            >Password <input type="password" name="password" required
          /></label>
        </div>
      </fieldset>

      <fieldset>
        <legend>Basic Info</legend>

        <div>
          <label
            >* First Name
            <input type="text" name="firstName" value="Abebe" required disabled
          /></label>
        </div>

        <div>
          <label
            >* Father Name
            <input type="text" name="lastName" value="Kebede" required disabled
          /></label>
        </div>

        <div>
          <p>* Sex</p>

          <label
            >Male
            <input
              type="radio"
              name="sex"
              value="male"
              checked
              required
              disabled
          /></label>

          <label
            >Female
            <input type="radio" name="sex" value="female" required disabled
          /></label>
        </div>

        <div>
          * Religion

          <label>
            <input
              type="radio"
              name="religion"
              value="catholic"
              required
              checked
            />
            Catholic
          </label>

          <label>
            <input type="radio" name="religion" value="judaism" required />
            Judaism
          </label>
          <label>
            <input type="radio" name="religion" value="muslim" required />
            Muslim
          </label>
          <label>
            <input type="radio" name="religion" value="orthodox" required />
            Orthodox
          </label>
          <label>
            <input type="radio" name="religion" value="protestant" required />
            Protestant
          </label>
          <label>
            <input type="radio" name="religion" value="other" required />
            Other
          </label>
        </div>

        <div>
          <label
            >* Birthday
            <input type="date" name="birthday" value="2000-01-01" required
          /></label>
        </div>

        <div>
          <label
            >* Bio. Say A few Words About Your Self
            <input
              type="text"
              name="bio"
              value="The fault in our dreams"
              required
          /></label>
        </div>

        <div>
          <label
            >Profile Picture
            <input
              type="file"
              name="profilePicture"
              accept="image/png, image/jpeg"
            />
          </label>
        </div>
      </fieldset>

      <fieldset>
        <legend>Optional</legend>

        <div>
          religiousPreferences

          <label>
            <input
              type="checkbox"
              name="religiousPreferences"
              value="catholic"
            />
            Catholic
          </label>

          <label>
            <input
              type="checkbox"
              name="religiousPreferences"
              value="judaism"
            />
            Judaism
          </label>
          <label>
            <input
              type="checkbox"
              name="religiousPreferences"
              value="musliim"
            />
            Muslim
          </label>
          <label>
            <input
              type="checkbox"
              name="religiousPreferences"
              value="orthodox"
            />
            Orthodox
          </label>
          <label>
            <input
              type="checkbox"
              name="religiousPreferences"
              value="protestant"
            />
            Protestant
          </label>
          <label>
            <input type="checkbox" name="religiousPreferences" value="other" />
            Other
          </label>
        </div>

        <div>
          <label
            >Your Height (in centimeters) <input type="number" name="height"
          /></label>
        </div>

        <div>
          <p>height range</p>

          <div>
            <label
              >Minimum height <input type="number" name="minHeight"
            /></label>
          </div>

          <div>
            <label
              >Maximum height <input type="number" name="maxHeight"
            /></label>
          </div>
        </div>

        <div>
          <p>Age Range</p>

          <input type="number" name="minAge" />
          <label>Minimum Age </label>

          <label
            >Maximum Age
            <input type="number" name="maxAge" />
          </label>
        </div>

        <div>
          <p>Hobbies</p>
          <label>
            <input type="checkbox" name="hobbies" value="movies" />
            Movies
          </label>

          <label>
            <input type="checkbox" name="hobbies" value="picnic-at-mars" />
            picnic-at-mars
          </label>
          <label>
            <input type="checkbox" name="hobbies" value="the-office" />
            the-office
          </label>
          <label>
            <input type="checkbox" name="hobbies" value="jamaica" />
            jamaica
          </label>
          <label>
            <input type="checkbox" name="hobbies" value="chicken-cheese" />
            chicken-cheese
          </label>
          <label>
            <input type="checkbox" name="hobbies" value="counting-stars" />
            counting-stars
          </label>
        </div>
        <div>
          <p>Your Education Level</p>

          <label>
            <input type="radio" name="educationLevel" value="10" required />
            MiddleSchool
          </label>

          <label>
            <input type="radio" name="educationLevel" value="20" required />
            HighSchool
          </label>
          <label>
            <input type="radio" name="educationLevel" value="30" required />
            University/College
          </label>
          <label>
            <input type="radio" name="educationLevel" value="40" required />
            Masters
          </label>
          <label>
            <input type="radio" name="educationLevel" value="50" required />
            Professor
          </label>
          <label>
            <input
              type="radio"
              name="educationLevel"
              value=""
              required
              checked
            />
            None
          </label>
        </div>
        <div>
          <p>My partner should not be educated below..</p>

          <label>
            <input
              type="radio"
              name="preferredEducationLevel"
              value="10"
              required
            />
            MiddleSchool
          </label>

          <label>
            <input
              type="radio"
              name="preferredEducationLevel"
              value="20"
              required
            />
            HighSchool
          </label>
          <label>
            <input
              type="radio"
              name="preferredEducationLevel"
              value="30"
              required
            />
            University/College
          </label>
          <label>
            <input
              type="radio"
              name="preferredEducationLevel"
              value="40"
              required
            />
            Masters
          </label>
          <label>
            <input
              type="radio"
              name="preferredEducationLevel"
              value="50"
              required
            />
            Professor
          </label>
          <label>
            <input
              type="radio"
              name="preferredEducationLevel"
              value=""
              required
              checked
            />
            I don't mind
          </label>
        </div>

        <div>
          <p>Location</p>
          <label>
            Save My Location
            <input type="checkbox" name="" id="allow-location-check-box" />
          </label>

          <label>
            Good if partner is within
            <input type="number" name="kmRadius" />
            kms
          </label>
        </div>
      </fieldset>
      <button>SAVE</button>
    </form>

    <div>
      <button id="delete-account-btn">Delete Account?</button>
    </div>
  </body>
  <script src="./fill-form.js"></script>
  <script src="./save-location-if-possible.js"></script>

  <script>
    const editForm = document.getElementById("edit-form");
    const profilePicture = document.getElementById("profile-picture");
    const NEXT_URL = "/login.html"; //EDIT THIS IF CHANGED
    const allowLocationCheckBox = document.getElementById(
      "allow-location-check-box"
    );

    fetchAndFill();
    async function fetchAndFill() {
      const url = "/api/profile";

      const response = await fetch(url);
      console.log(response);
      const data = await response.json();
      console.log(data);
      if (response.ok) {
        fillForm(data, editForm);
        profilePicture.setAttribute("src", data.photoUrl);
      }
    }

    editForm.onsubmit = async function (event) {
      event.preventDefault();
      const formData = new FormData(editForm);
      await saveLocationIfPossible(formData, allowLocationCheckBox);

      console.log(...formData);
      const result = await fetch("/api/profile", {
        method: "PUT",
        body: formData,
      });
      const data = await result.json();
      console.log(data);
    };
  </script>

  <script>
    const deleteAccountButton = document.getElementById("delete-account-btn");
    deleteAccountButton.addEventListener("click", handleDeleteAccount);

    async function handleDeleteAccount() {
      const NEXT_URL = "home.html";
      const result = await fetch("/api/", { method: "DELETE" });
      if (result.ok) {
        alert("account deleted");
        window.location = NEXT_URL;
      } else {
        alert("account not deleted");
      }
    }
  </script>
</html>
